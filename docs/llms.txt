# areaOfEffect

[![R-CMD-check](https://github.com/gcol33/areaOfEffect/actions/workflows/R-CMD-check.yml/badge.svg)](https://github.com/gcol33/areaOfEffect/actions/workflows/R-CMD-check.yml)
[![License:
MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**Classify occurrence records relative to country borders — without
writing sf code.**

Dataframe in → dataframe out. No CRS headaches. No buffer distance
guessing.

![Austria with Area of Effect](reference/figures/austria-aoe.svg)

## Quick Start

``` r

library(areaOfEffect)

# Your occurrence data
observations <- data.frame(
  species = c("A", "B", "C", "D"),
  lon = c(14.5, 15.2, 16.8, 20.0),
  lat = c(47.5, 48.1, 47.2, 48.5)
)

# One line - get back a classified dataframe
result <- aoe(observations, "Austria")
result$aoe_class
#> [1] "core" "core" "halo"
# (point D pruned - outside area of effect)
```

## Philosophy

areaOfEffect does not invent new geometry. It standardizes a common
spatial task: classifying points by their position relative to a
region’s boundary.

**Instead of choosing arbitrary buffer distances, halos are defined as a
fixed proportion of region area** — enabling consistent cross-country
comparisons without CRS expertise.

This is the kind of spatial task ecologists repeatedly reimplement with
subtle errors. This package handles:

- Coordinate column auto-detection
- Country lookup by name or ISO code
- Equal-area projection (done correctly)
- Area-based buffer calculation
- Point classification
- Clean dataframe output

You don’t need to learn CRS theory, when buffering in degrees is wrong,
or why
[`st_covers()`](https://r-spatial.github.io/sf/reference/geos_binary_pred.html)
sometimes returns `FALSE`. You just get a column that says `core` or
`halo`.

## Statement of Need

Political borders are not hard ecological boundaries. Biological
processes do not stop at administrative lines. When sampling within a
political region, observations near the border are influenced by
conditions outside that region.

The **area of effect** corrects for this border truncation by expanding
the support outward. Points are then classified:

- **Core**: inside the original support
- **Halo**: outside the original support but inside the expanded area of
  effect
- **Pruned**: outside the area of effect (not returned)

By default, the halo has **equal area to the core** — a scale-free,
proportion-based definition that enables consistent cross-country
comparisons.

## Features

- **Dataframe workflow**: Plain dataframes with coordinates go in,
  classified dataframes come out
- **Country lookup**: Pass ISO codes or names directly (`"AT"`,
  `"Austria"`)
- **Auto-detection**: Omit support to detect countries from points
- **Area-based halos**: Proportion of region area, not arbitrary
  distances
- **Multiple supports**: Process admin regions with long format output
- **Masking**: Coastlines and other hard constraints
- **S3 methods**: [`print()`](https://rdrr.io/r/base/print.html),
  [`summary()`](https://rdrr.io/r/base/summary.html),
  [`plot()`](https://rdrr.io/r/graphics/plot.default.html)

## Installation

``` r

# Install from GitHub
# install.packages("pak")
pak::pak("gcol33/areaOfEffect")
```

## Usage

### From a Dataframe

``` r

library(areaOfEffect)

# Plain dataframe with coordinates
df <- data.frame(
  id = 1:4,
  longitude = c(14.5, 15.2, 16.8, 20.0),
  latitude = c(47.5, 48.1, 47.2, 48.5)
)

# Classify relative to Austria
result <- aoe(df, "Austria")
```

### From sf Objects

``` r

library(sf)

# sf points work too
pts_sf <- st_as_sf(df, coords = c("longitude", "latitude"), crs = 4326)
result <- aoe(pts_sf, "AT")
```

### Multiple Countries

``` r

# Austria + Germany
result <- aoe(df, c("AT", "DE"))

# Auto-detect countries from points
result <- aoe(df)
```

### With Mask (e.g., Land Only)

``` r

result <- aoe(df, "Austria", mask = land_polygon)
```

## Scale

The `scale` parameter controls halo size as a proportion of core area.

Default: `sqrt(2) - 1` ≈ 0.414, which gives **equal core and halo
areas**.

| Scale                   | Halo:Core Area |
|-------------------------|----------------|
| `sqrt(2) - 1` (default) | 1:1            |
| `1`                     | 3:1            |
| `0.5`                   | 1.25:1         |

## Documentation

- [Quick Start
  Vignette](https://gcol33.github.io/areaOfEffect/articles/quickstart.html)
- [Function
  Reference](https://gcol33.github.io/areaOfEffect/reference/index.html)

## Support

I’m a PhD student who builds R packages in my free time because I
believe good tools should be free and open.

If this package saved you time, buying me a coffee is a nice way to say
thanks.

[![Buy Me A
Coffee](https://img.shields.io/badge/-Buy%20me%20a%20coffee-FFDD00?logo=buymeacoffee&logoColor=black)](https://buymeacoffee.com/gcol33)

## License

MIT

## Citation

``` bibtex
@software{areaOfEffect,
  author = {Colling, Gilles},
  title = {areaOfEffect: Area-Based Spatial Classification for Ecological Data},
  year = {2025},
  url = {https://github.com/gcol33/areaOfEffect}
}
```

# Package index

## Core

- [`aoe()`](https://gcol33.github.io/areaOfEffect/reference/aoe.md) :
  Classify and Prune Points by Area of Effect
- [`aoe_expand()`](https://gcol33.github.io/areaOfEffect/reference/aoe_expand.md)
  : Adaptive AoE Expansion to Capture Minimum Points
- [`aoe_sample()`](https://gcol33.github.io/areaOfEffect/reference/aoe_sample.md)
  : Stratified Sampling from AoE Results

## Data

- [`countries`](https://gcol33.github.io/areaOfEffect/reference/countries.md)
  : World Country Polygons with Pre-calculated AoE Bounds
- [`country_halos`](https://gcol33.github.io/areaOfEffect/reference/country_halos.md)
  : Pre-computed Equal-Area Country Halos
- [`land`](https://gcol33.github.io/areaOfEffect/reference/land.md) :
  Global Land Mask
- [`get_country()`](https://gcol33.github.io/areaOfEffect/reference/get_country.md)
  : Get Country Polygon by Name or ISO Code

## Diagnostics

- [`aoe_summary()`](https://gcol33.github.io/areaOfEffect/reference/aoe_summary.md)
  : Summarize Area of Effect Results
- [`aoe_area()`](https://gcol33.github.io/areaOfEffect/reference/aoe_area.md)
  : Compute Area Statistics for AoE
- [`aoe_geometry()`](https://gcol33.github.io/areaOfEffect/reference/aoe_geometry.md)
  : Extract AoE Geometries

## S3 Methods

- [`print(`*`<aoe_result>`*`)`](https://gcol33.github.io/areaOfEffect/reference/print.aoe_result.md)
  : Print method for aoe_result
- [`print(`*`<aoe_expand_result>`*`)`](https://gcol33.github.io/areaOfEffect/reference/print.aoe_expand_result.md)
  : Print method for aoe_expand_result
- [`print(`*`<aoe_area_result>`*`)`](https://gcol33.github.io/areaOfEffect/reference/print.aoe_area_result.md)
  : Print method for aoe_area_result
- [`print(`*`<aoe_summary_result>`*`)`](https://gcol33.github.io/areaOfEffect/reference/print.aoe_summary_result.md)
  : Print method for aoe_summary_result
- [`summary(`*`<aoe_result>`*`)`](https://gcol33.github.io/areaOfEffect/reference/summary.aoe_result.md)
  : Summary method for aoe_result
- [`plot(`*`<aoe_result>`*`)`](https://gcol33.github.io/areaOfEffect/reference/plot.aoe_result.md)
  : Plot method for aoe_result
- [`` `[`( ``*`<aoe_result>`*`)`](https://gcol33.github.io/areaOfEffect/reference/sub-.aoe_result.md)
  : Subset method for aoe_result

# Articles

### Getting Started

- [Quick
  Start](https://gcol33.github.io/areaOfEffect/articles/quickstart.md):

### Background

- [Theory](https://gcol33.github.io/areaOfEffect/articles/theory.md):
