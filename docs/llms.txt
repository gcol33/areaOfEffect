# areaOfEffect

[![R-CMD-check](https://github.com/gcol33/areaOfEffect/actions/workflows/R-CMD-check.yml/badge.svg)](https://github.com/gcol33/areaOfEffect/actions/workflows/R-CMD-check.yml)
[![License:
MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**Spatial Support at Scale**

The `areaOfEffect` package formalizes spatial support at scale. Given a
set of points and one or more support polygons,
[`aoe()`](https://gillescolling.com/areaOfEffect/reference/aoe.md)
classifies points as “core” (inside original support) or “halo” (inside
the area of effect but outside original support), pruning all points
outside.

## Concept

Political borders are not hard ecological boundaries. Biological
processes do not stop at administrative lines. When sampling within a
political region, observations near the border are influenced by
conditions outside that region.

The **area of effect** (AoE) corrects for this border truncation by
expanding the support outward from its centroid. Points are then
classified:

- **Core**: inside the original support
- **Halo**: outside the original support but inside the expanded area of
  effect
- **Pruned**: outside the area of effect (not returned)

By default, the AoE expands to give **equal core and halo areas**.

Sea boundaries are hard boundaries. An optional mask can enforce such
constraints.

## Scale

Default: `sqrt(2) - 1 ≈ 0.414`, which gives equal core and halo areas.

| Scale                | Multiplier | Area Ratio |
|----------------------|------------|------------|
| **√2 − 1** (default) | **1.414**  | **1:1**    |
| 1                    | 2          | 1:3        |

## Installation

``` r

# Install from GitHub
# install.packages("pak")
pak::pak("gcol33/areaOfEffect")
```

## Usage

### Single Support

``` r

library(areaOfEffect)
library(sf)

# Create example support polygon (e.g., a country or region)
support <- st_as_sf(
  data.frame(id = 1),
  geometry = st_sfc(st_polygon(list(
    cbind(c(0, 100, 100, 0, 0), c(0, 0, 100, 100, 0))
  ))),
  crs = 32631
)

# Create observation points
pts <- st_as_sf(
  data.frame(id = 1:4),
  geometry = st_sfc(
    st_point(c(50, 50)),   # core (center)
    st_point(c(10, 10)),   # core (inside)
    st_point(c(150, 50)),  # halo (outside original, inside AoE)
    st_point(c(300, 300))  # outside (will be pruned)
  ),
  crs = 32631
)

# Apply area of effect
result <- aoe(pts, support)

# View classification
result$aoe_class
#> [1] "core" "core" "halo"
```

### Multiple Supports (Parallel Processing)

When multiple supports are provided, each is processed independently.
Points can appear multiple times if they fall within multiple AoEs.

``` r

# Two adjacent admin regions
supports <- st_as_sf(
  data.frame(region = c("A", "B")),
  geometry = st_sfc(
    st_polygon(list(cbind(c(0, 50, 50, 0, 0), c(0, 0, 100, 100, 0)))),
    st_polygon(list(cbind(c(50, 100, 100, 50, 50), c(0, 0, 100, 100, 0))))
  ),
  crs = 32631
)

# Points near the shared boundary
pts <- st_as_sf(
  data.frame(id = 1:3),
  geometry = st_sfc(
    st_point(c(25, 50)),   # inside A
    st_point(c(50, 50)),   # on boundary
    st_point(c(75, 50))    # inside B
  ),
  crs = 32631
)

result <- aoe(pts, supports)
# Points may appear in both regions' output (long format)
```

### With a Mask (e.g., Land Boundary)

``` r

# Create land mask (excludes sea)
land <- st_as_sf(
  data.frame(id = 1),
  geometry = st_sfc(st_polygon(list(
    cbind(c(-50, 200, 200, -50, -50), c(0, 0, 150, 150, 0))
  ))),
  crs = 32631
)

# Apply with mask
result <- aoe(pts, support, mask = land)
```

### Diagnostic Summary

``` r

result <- aoe(pts, support)
aoe_summary(result)
#>   support_id n_total n_core n_halo prop_core prop_halo
#> 1          1       3      2      1     0.667     0.333
```

## Function Signature

``` r

aoe(points, support, scale = sqrt(2) - 1, reference = NULL, mask = NULL)
```

| Argument | Type | Default | Description |
|----|----|----|----|
| `points` | sf (POINT) | required | Points to classify and prune |
| `support` | sf (POLYGON/MULTIPOLYGON) | required | One or more support regions (each row = separate AoE) |
| `scale` | numeric | √2 − 1 | Scale factor; default gives equal core/halo areas |
| `reference` | sf (POINT) or NULL | NULL | Reference point; only valid for single support |
| `mask` | sf (POLYGON) or NULL | NULL | Hard boundary; AoE intersected with mask |

## Return Value

An `aoe_result` object (extends `sf`) containing only supported points,
with:

- `point_id` column: original point identifier
- `support_id` column: identifier for which support the classification
  refers to
- `aoe_class` column: `"core"` or `"halo"`

S3 methods: [`print()`](https://rdrr.io/r/base/print.html),
[`summary()`](https://rdrr.io/r/base/summary.html),
[`plot()`](https://rdrr.io/r/graphics/plot.default.html). Use
[`aoe_geometry()`](https://gillescolling.com/areaOfEffect/reference/aoe_geometry.md)
to extract polygons,
[`aoe_area()`](https://gillescolling.com/areaOfEffect/reference/aoe_area.md)
for area statistics.

When multiple supports are provided, points may appear multiple times
(once per support whose AoE contains them).

## Design

- **Not a buffer**: AoE scales from the centroid, not by fixed distance
- **Default scale**: Equal core/halo areas
- **Mask support**: Coastlines and other hard constraints
- **Multiple supports**: Long format output

## License

MIT

## Citation

``` bibtex
@software{areaOfEffect,
  author = {Colling, Gilles},
  title = {areaOfEffect: Spatial Support at Scale},
  year = {2026},
  url = {https://github.com/gcol33/areaOfEffect}
}
```

# Package index

## Core

- [`aoe()`](https://gillescolling.com/areaOfEffect/reference/aoe.md) :
  Classify and Prune Points by Area of Effect

## Data

- [`countries`](https://gillescolling.com/areaOfEffect/reference/countries.md)
  : World Country Polygons with Pre-calculated AoE Bounds
- [`get_country()`](https://gillescolling.com/areaOfEffect/reference/get_country.md)
  : Get Country Polygon by Name or ISO Code

## Diagnostics

- [`aoe_summary()`](https://gillescolling.com/areaOfEffect/reference/aoe_summary.md)
  : Summarize Area of Effect Results
- [`aoe_area()`](https://gillescolling.com/areaOfEffect/reference/aoe_area.md)
  : Compute Area Statistics for AoE
- [`aoe_geometry()`](https://gillescolling.com/areaOfEffect/reference/aoe_geometry.md)
  : Extract AoE Geometries

## S3 Methods

- [`print(`*`<aoe_result>`*`)`](https://gillescolling.com/areaOfEffect/reference/print.aoe_result.md)
  : Print method for aoe_result
- [`summary(`*`<aoe_result>`*`)`](https://gillescolling.com/areaOfEffect/reference/summary.aoe_result.md)
  : Summary method for aoe_result
- [`plot(`*`<aoe_result>`*`)`](https://gillescolling.com/areaOfEffect/reference/plot.aoe_result.md)
  : Plot method for aoe_result
- [`print(`*`<aoe_area_result>`*`)`](https://gillescolling.com/areaOfEffect/reference/print.aoe_area_result.md)
  : Print method for aoe_area_result
- [`print(`*`<aoe_summary_result>`*`)`](https://gillescolling.com/areaOfEffect/reference/print.aoe_summary_result.md)
  : Print method for aoe_summary_result
- [`` `[`( ``*`<aoe_result>`*`)`](https://gillescolling.com/areaOfEffect/reference/sub-.aoe_result.md)
  : Subset method for aoe_result

# Articles

### Getting Started

- [Getting Started with
  areaOfEffect](https://gillescolling.com/areaOfEffect/articles/quickstart.md):

### Background

- [The Area of Effect
  Concept](https://gillescolling.com/areaOfEffect/articles/theory.md):
