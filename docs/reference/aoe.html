<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Classify and Prune Points by Area of Effect — aoe • areaOfEffect</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Classify and Prune Points by Area of Effect — aoe"><meta name="description" content='Given a set of points and one or more support polygons, aoe() classifies
points as "core" (inside original support) or "halo" (inside the area of
effect but outside original support), pruning all points outside.'><meta property="og:description" content='Given a set of points and one or more support polygons, aoe() classifies
points as "core" (inside original support) or "halo" (inside the area of
effect but outside original support), pruning all points outside.'></head><body><p>








  pkgdown/mathjax-config.html

  

  </p>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">areaOfEffect</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/quickstart.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/quickstart.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/theory.html">Theory</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/areaOfEffect" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Classify and Prune Points by Area of Effect</h1>
      <small class="dont-index">Source: <a href="https://github.com/gcol33/areaOfEffect/blob/HEAD/R/aoe.R" class="external-link"><code>R/aoe.R</code></a></small>
      <div class="d-none name"><code>aoe.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Given a set of points and one or more support polygons, <code>aoe()</code> classifies
points as "core" (inside original support) or "halo" (inside the area of
effect but outside original support), pruning all points outside.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">aoe</span><span class="op">(</span></span>
<span>  <span class="va">points</span>,</span>
<span>  support <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  area <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"buffer"</span>, <span class="st">"stamp"</span><span class="op">)</span>,</span>
<span>  reference <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mask <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  largest_polygon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  coords <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-points">points<a class="anchor" aria-label="anchor" href="#arg-points"></a></dt>
<dd><p>An <code>sf</code> object with POINT geometries.</p></dd>


<dt id="arg-support">support<a class="anchor" aria-label="anchor" href="#arg-support"></a></dt>
<dd><p>One of:</p><ul><li><p><code>sf</code> object with POLYGON/MULTIPOLYGON geometries</p></li>
<li><p>Country name or ISO code: <code>"France"</code>, <code>"FR"</code>, <code>"FRA"</code></p></li>
<li><p>Vector of countries: <code>c("France", "Germany")</code></p></li>
<li><p>Missing: auto-detects countries containing the points</p></li>
</ul></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>Numeric scale factor (default <code>sqrt(2) - 1</code>, approximately 0.414).
Controls the size of the halo relative to the core:</p><ul><li><p><code>sqrt(2) - 1</code> (default): equal core/halo areas, ratio 1:1</p></li>
<li><p><code>1</code>: area ratio 1:3 (halo is 3x core area)</p></li>
</ul><p>For <code>method = "buffer"</code>, determines the target halo area as
<code>original_area * ((1 + scale)^2 - 1)</code>.</p>
<p>For <code>method = "stamp"</code>, the multiplier <code>1 + scale</code> is applied to distances
from the reference point.</p>
<p>Cannot be used together with <code>area</code>.</p></dd>


<dt id="arg-area">area<a class="anchor" aria-label="anchor" href="#arg-area"></a></dt>
<dd><p>Numeric area proportion (alternative to <code>scale</code>).
Specifies the target halo area as a proportion of the original support area.
For example, <code>area = 1</code> means halo area equals the original support area.</p>
<p>Unlike <code>scale</code>, this parameter accounts for masking: the function finds
the scale that produces the target halo area <em>after</em> mask intersection.
This is useful when you need a specific effective area regardless of
how much gets clipped by coastlines or borders.</p>
<p>Cannot be used together with <code>scale</code>.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Method for computing the area of effect:</p><ul><li><p><code>"buffer"</code> (default): Uniform buffer around the support boundary.
Robust for any polygon shape. Buffer distance is calculated to achieve
the target halo area.</p></li>
<li><p><code>"stamp"</code>: Scale vertices outward from the centroid (or reference point).
Preserves shape proportions but only guarantees containment for
star-shaped polygons. May leave small gaps for highly concave shapes.</p></li>
</ul></dd>


<dt id="arg-reference">reference<a class="anchor" aria-label="anchor" href="#arg-reference"></a></dt>
<dd><p>Optional <code>sf</code> object with a single POINT geometry.</p>
<p>If <code>NULL</code> (default), the centroid of each support is used.
Only valid when <code>support</code> has a single row and <code>method = "stamp"</code>.</p></dd>


<dt id="arg-mask">mask<a class="anchor" aria-label="anchor" href="#arg-mask"></a></dt>
<dd><p>Optional mask for clipping the area of effect. Can be:</p><ul><li><p><code>sf</code> object with POLYGON or MULTIPOLYGON geometry</p></li>
<li><p><code>"land"</code>: use the bundled global land mask to exclude sea areas
If provided, each area of effect is intersected with this mask.</p></li>
</ul></dd>


<dt id="arg-largest-polygon">largest_polygon<a class="anchor" aria-label="anchor" href="#arg-largest-polygon"></a></dt>
<dd><p>Logical (default <code>TRUE</code>). When the support contains
multiple polygons (e.g., mainland plus islands), use only the largest
polygon by area. This is typically the mainland. Points near dropped
polygons will be pruned entirely (not classified). Set to <code>FALSE</code> to
include all polygons, in which case <code>area = "equal"</code> uses total area
with redistribution across all polygons.</p></dd>


<dt id="arg-coords">coords<a class="anchor" aria-label="anchor" href="#arg-coords"></a></dt>
<dd><p>Column names for coordinates when <code>points</code> is a data.frame,
e.g. <code>c("lon", "lat")</code>. If <code>NULL</code>, auto-detects common names.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>aoe_result</code> object (extends <code>sf</code>) containing only the supported
points, with columns:</p><dl><dt>point_id</dt>
<dd><p>Original point identifier (row name or index)</p></dd>

<dt>support_id</dt>
<dd><p>Identifier for which support the classification refers to</p></dd>

<dt>aoe_class</dt>
<dd><p>Classification: <code>"core"</code> or <code>"halo"</code></p></dd>


</dl><p>When multiple supports are provided, points may appear multiple times
(once per support whose AoE contains them).</p>
<p>The result has S3 methods for <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.
Use <code><a href="aoe_geometry.html">aoe_geometry()</a></code> to extract the AoE polygons.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>By default, the area of effect is computed using a buffer that produces
equal core and halo areas. This means the AoE has twice the area of the
original support, split evenly between core (inside) and halo (outside).</p><div class="section">
<h3 id="buffer-method-default-">Buffer method (default)<a class="anchor" aria-label="anchor" href="#buffer-method-default-"></a></h3>


<p>Computes a uniform buffer distance \(d\) such that the buffered area
equals the target. The buffer distance is found by solving:
$$\pi d^2 + P \cdot d = A_{target}$$
where \(P\) is the perimeter and \(A_{target}\) is the desired halo area.</p>
</div>

<div class="section">
<h3 id="stamp-method">Stamp method<a class="anchor" aria-label="anchor" href="#stamp-method"></a></h3>


<p>Applies an affine transformation to each vertex:
$$p' = r + (1 + s)(p - r)$$
where \(r\) is the reference point (centroid), \(p\) is each vertex,
and \(s\) is the scale factor. This method preserves shape proportions
but only guarantees the AoE contains the original for star-shaped polygons
(where the centroid can "see" all boundary points).</p>
<p>Points exactly on the original support boundary are classified as "core".</p>
<p>The support geometry is validated internally using <code><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">sf::st_make_valid()</a></code>.</p>
</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Single support</span></span>
<span><span class="va">support</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fl">32631</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fl">32631</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">aoe</span><span class="op">(</span><span class="va">pts</span>, <span class="va">support</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Multiple supports (e.g., admin regions)</span></span>
<span><span class="va">supports</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">18</span>, <span class="fl">18</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fl">32631</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">aoe</span><span class="op">(</span><span class="va">pts</span>, <span class="va">supports</span><span class="op">)</span></span>
<span><span class="co"># Points near the boundary may appear in both regions' AoE</span></span>
<span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gilles Colling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  
</body></html>

