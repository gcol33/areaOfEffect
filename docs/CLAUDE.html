<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • areaOfEffect</title><script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet"><meta property="og:title" content="CLAUDE.md"></head><body><p>








  pkgdown/mathjax-config.html

  

  </p>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">areaOfEffect</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="articles/quickstart.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/quickstart.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="articles/theory.html">Theory</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/areaOfEffect" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>CLAUDE.md</h1>
      <small class="dont-index">Source: <a href="https://github.com/gcol33/areaOfEffect/blob/HEAD/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="package-overview">Package Overview<a class="anchor" aria-label="anchor" href="#package-overview"></a></h2>
<p>areaOfEffect is an R package for spatial support classification in ecological analysis. It classifies occurrence points as “core” (inside original support polygon) or “halo” (inside expanded area of effect but outside original), pruning points outside both. The default expansion produces equal core and halo areas.</p>
</div>
<div class="section level2">
<h2 id="development-commands">Development Commands<a class="anchor" aria-label="anchor" href="#development-commands"></a></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Run tests</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="st">"C:\Program Files\R\R-4.5.2\bin\Rscript.exe"</span> <span class="at">-e</span> <span class="st">"testthat::test_local()"</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Run single test file</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="st">"C:\Program Files\R\R-4.5.2\bin\Rscript.exe"</span> <span class="at">-e</span> <span class="st">"testthat::test_file('tests/testthat/test-aoe.R')"</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># Check package (R CMD check equivalent)</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="st">"C:\Program Files\R\R-4.5.2\bin\Rscript.exe"</span> <span class="at">-e</span> <span class="st">"devtools::check()"</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># Build documentation (roxygen2)</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="st">"C:\Program Files\R\R-4.5.2\bin\Rscript.exe"</span> <span class="at">-e</span> <span class="st">"devtools::document()"</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># Install package locally</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="st">"C:\Program Files\R\R-4.5.2\bin\Rscript.exe"</span> <span class="at">-e</span> <span class="st">"devtools::install()"</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co"># Build pkgdown site</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="st">"C:\Program Files\R\R-4.5.2\bin\Rscript.exe"</span> <span class="at">-e</span> <span class="st">"source('~/.R/build_pkgdown.R'); build_pkgdown_site()"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a></h2>
<div class="section level3">
<h3 id="core-functions-r">Core Functions (R/)<a class="anchor" aria-label="anchor" href="#core-functions-r"></a></h3>
<ul><li>
<p><strong>aoe.R</strong>: Main <code><a href="reference/aoe.html">aoe()</a></code> function - classifies points relative to support polygons</p>
<ul><li>Supports country names/codes (uses bundled <code>countries</code> data) or custom sf polygons</li>
<li>Two expansion methods: <code>buffer</code> (uniform boundary expansion) and <code>stamp</code> (vertex scaling from centroid)</li>
<li>
<code>scale</code> parameter controls halo size; <code>area</code> parameter finds scale achieving target masked halo area</li>
<li>
<code>mask</code> parameter clips expansion (e.g., <code>mask = "land"</code> clips to coastlines)</li>
</ul></li>
<li>
<p><strong>aoe_border.R</strong>: <code><a href="reference/aoe_border.html">aoe_border()</a></code> - classifies points by distance from a line (border)</p>
<ul><li>Creates symmetric buffer zones on both sides</li>
<li>Returns <code>aoe_border_result</code> S3 class with side and core/halo classification</li>
</ul></li>
<li>
<p><strong>aoe_class.R</strong>: S3 class infrastructure for <code>aoe_result</code></p>
<ul><li>
<code>print</code>, <code>summary</code>, <code>plot</code>, and <code>[</code> methods</li>
<li>Stores geometries as attributes for later extraction</li>
</ul></li>
<li><p><strong>aoe_geometry.R</strong>: <code><a href="reference/aoe_geometry.html">aoe_geometry()</a></code> - extracts support/AoE polygons from results</p></li>
<li><p><strong>aoe_area.R</strong>: <code><a href="reference/aoe_area.html">aoe_area()</a></code> - area diagnostics (original, raw AoE, masked AoE)</p></li>
<li><p><strong>aoe_expand.R</strong>: <code><a href="reference/aoe_expand.html">aoe_expand()</a></code> - expand geometries without point classification</p></li>
<li><p><strong>aoe_sample.R</strong>: <code><a href="reference/aoe_sample.html">aoe_sample()</a></code> - stratified sampling from results (by support, class, or side)</p></li>
<li><p><strong>aoe_summary.R</strong>: <code><a href="reference/aoe_summary.html">aoe_summary()</a></code> - point counts by support and class</p></li>
</ul></div>
<div class="section level3">
<h3 id="bundled-data-data">Bundled Data (data/)<a class="anchor" aria-label="anchor" href="#bundled-data-data"></a></h3>
<ul><li>
<code>countries.rda</code>: Country boundaries (sf) for lookup by name or ISO code</li>
<li>
<code>land.rda</code>: Global land polygon for coastline masking</li>
<li>
<code>country_halos.rda</code>: Pre-computed country halos</li>
</ul></div>
<div class="section level3">
<h3 id="key-dependencies">Key Dependencies<a class="anchor" aria-label="anchor" href="#key-dependencies"></a></h3>
<ul><li>
<strong>sf</strong>: All spatial operations (required)</li>
<li>
<strong>lwgeom</strong>: Optional, used for <code>st_split()</code> in border splitting (fallback exists)</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="code-patterns">Code Patterns<a class="anchor" aria-label="anchor" href="#code-patterns"></a></h2>
<div class="section level3">
<h3 id="geometry-expansion">Geometry Expansion<a class="anchor" aria-label="anchor" href="#geometry-expansion"></a></h3>
<p>Buffer method solves for distance <code>d</code> where <code>π*d² + P*d = A_target</code> (perimeter formula), then binary searches for exact fit.</p>
<p>Stamp method applies affine transformation: <code>p' = r + (1+scale)(p - r)</code> from reference point.</p>
</div>
<div class="section level3">
<h3 id="area-mode-vs-scale-mode">Area Mode vs Scale Mode<a class="anchor" aria-label="anchor" href="#area-mode-vs-scale-mode"></a></h3>
<ul><li>
<code>scale</code> parameter: direct geometric scaling (halo area = original × ((1+scale)² - 1))</li>
<li>
<code>area</code> parameter: finds scale that produces target halo area <em>after</em> mask intersection, using secant method</li>
</ul></div>
<div class="section level3">
<h3 id="s3-classes">S3 Classes<a class="anchor" aria-label="anchor" href="#s3-classes"></a></h3>
<ul><li>
<code>aoe_result</code>: Extends sf, stores geometries in <code>aoe_geometries</code> attribute</li>
<li>
<code>aoe_border_result</code>: Extends sf, stores border/zone geometries in <code>border_geometries</code> attribute</li>
<li>Both preserve attributes through subsetting via custom <code>[</code> methods</li>
</ul></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gilles Colling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  
</body></html>

