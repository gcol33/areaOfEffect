<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>areaOfEffect Implementation Plan • areaOfEffect</title><script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet"><meta property="og:title" content="areaOfEffect Implementation Plan"></head><body><p>








  pkgdown/mathjax-config.html

  

  </p>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">areaOfEffect</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="articles/index.html">Articles</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/areaOfEffect"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>areaOfEffect Implementation Plan</h1>
      <small class="dont-index">Source: <a href="https://github.com/gcol33/areaOfEffect/blob/HEAD/IMPLEMENTATION_PLAN.md" class="external-link"><code>IMPLEMENTATION_PLAN.md</code></a></small>
    </div>

<div id="areaofeffect-implementation-plan" class="section level1">

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
<p>This plan outlines improvements to the areaOfEffect package, focusing on: 1. Better output structure (S3 class with methods) 2. Geometry access (<code><a href="reference/aoe_geometry.html">aoe_geometry()</a></code>) 3. ID preservation 4. Diagnostic helpers (<code><a href="reference/aoe_area.html">aoe_area()</a></code>) 5. Visualization (<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method)</p>
<p>All changes maintain backwards compatibility with existing API.</p>
<hr></div>
<div class="section level2">
<h2 id="phase-1-s3-class-infrastructure">Phase 1: S3 Class Infrastructure<a class="anchor" aria-label="anchor" href="#phase-1-s3-class-infrastructure"></a></h2>
<div class="section level3">
<h3 id="id_11-create-aoe_result-s3-class">1.1 Create <code>aoe_result</code> S3 class<a class="anchor" aria-label="anchor" href="#id_11-create-aoe_result-s3-class"></a></h3>
<p><strong>File</strong>: <code>R/aoe_class.R</code></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Constructor (internal)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>new_aoe_result <span class="ot">&lt;-</span> <span class="cf">function</span>(points, geometries, scale, n_supports) {</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="fu">structure</span>(</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    points,</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    <span class="at">class =</span> <span class="fu">c</span>(<span class="st">"aoe_result"</span>, <span class="st">"sf"</span>, <span class="st">"data.frame"</span>),</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="sc">+</span>    <span class="at">aoe_geometries =</span> geometries,</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="at">aoe_scale =</span> scale,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    <span class="at">aoe_n_supports =</span> n_supports</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  )</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Attributes stored</strong>: - <code>aoe_geometries</code>: list of sf objects (original support, AoE, masked AoE per support) - <code>aoe_scale</code>: numeric (always 1) - <code>aoe_n_supports</code>: integer</p>
</div>
<div class="section level3">
<h3 id="id_12-modify-aoe-to-return-aoe_result">1.2 Modify <code>aoe()</code> to return <code>aoe_result</code>
<a class="anchor" aria-label="anchor" href="#id_12-modify-aoe-to-return-aoe_result"></a></h3>
<p><strong>Changes to <code>R/aoe.R</code></strong>:</p>
<ol style="list-style-type: decimal"><li>
<p>Collect geometries during processing:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In process_single_support(), also return:</span></span>
<span><span class="co"># - original support geometry</span></span>
<span><span class="co"># - scaled AoE geometry (before mask)</span></span>
<span><span class="co"># - final AoE geometry (after mask, if applicable)</span></span></code></pre></div>
</li>
<li><p>Wrap result in <code>new_aoe_result()</code></p></li>
<li><p>Add <code>point_id</code> column preserving original row identifiers</p></li>
</ol><p><strong>Column structure after change</strong>: | Column | Description | |——–|————-| | <code>point_id</code> | Original point identifier (row name or index) | | <code>support_id</code> | Which support this classification refers to | | <code>aoe_class</code> | “core” or “halo” | | <code>geometry</code> | Point geometry (sf) | | <em>(original columns)</em> | All columns from input points |</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="phase-2-print-method">Phase 2: Print Method<a class="anchor" aria-label="anchor" href="#phase-2-print-method"></a></h2>
<div class="section level3">
<h3 id="id_21-printaoe_result">2.1 <code>print.aoe_result()</code>
<a class="anchor" aria-label="anchor" href="#id_21-printaoe_result"></a></h3>
<p><strong>File</strong>: <code>R/aoe_class.R</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @export</span></span>
<span><span class="va">print.aoe_result</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">n_supports</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"aoe_n_supports"</span><span class="op">)</span></span>
<span>  <span class="va">n_core</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">aoe_class</span> <span class="op">==</span> <span class="st">"core"</span><span class="op">)</span></span>
<span>  <span class="va">n_halo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">aoe_class</span> <span class="op">==</span> <span class="st">"halo"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Area of Effect Result\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"─────────────────────\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Points:   %d (%d core, %d halo)\n"</span>, <span class="va">n_points</span>, <span class="va">n_core</span>, <span class="va">n_halo</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Supports: %d\n"</span>, <span class="va">n_supports</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Scale:    %d (fixed)\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"aoe_scale"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Print first few rows as sf</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">NextMethod</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Example output</strong>:</p>
<pre><code>Area of Effect Result
─────────────────────
Points:   847 (612 core, 235 halo)
Supports: 3
Scale:    1 (fixed)

Simple feature collection with 847 features and 4 fields
Geometry type: POINT
...</code></pre>
<hr></div>
</div>
<div class="section level2">
<h2 id="phase-3-summary-method">Phase 3: Summary Method<a class="anchor" aria-label="anchor" href="#phase-3-summary-method"></a></h2>
<div class="section level3">
<h3 id="id_31-enhance-aoe_summary--summaryaoe_result">3.1 Enhance <code>aoe_summary()</code> → <code>summary.aoe_result()</code>
<a class="anchor" aria-label="anchor" href="#id_31-enhance-aoe_summary--summaryaoe_result"></a></h3>
<p><strong>File</strong>: <code>R/aoe_class.R</code></p>
<p>Keep <code><a href="reference/aoe_summary.html">aoe_summary()</a></code> as standalone function, but also register as S3 method.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @export</span></span>
<span><span class="va">summary.aoe_result</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Return aoe_summary_result S3 class</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/aoe_summary.html">aoe_summary</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aoe_summary_result"</span>, <span class="st">"data.frame"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Add area information if geometries available</span></span>
<span>  <span class="va">geoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"aoe_geometries"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">geoms</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">result</span><span class="op">$</span><span class="va">area_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">geoms</span>, <span class="kw">function</span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">original</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">result</span><span class="op">$</span><span class="va">area_aoe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">geoms</span>, <span class="kw">function</span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">aoe_final</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">result</span><span class="op">$</span><span class="va">area_ratio</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">area_aoe</span> <span class="op">/</span> <span class="va">result</span><span class="op">$</span><span class="va">area_original</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">result</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">print.aoe_summary_result</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Area of Effect Summary\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"──────────────────────\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Format nicely</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.dataframe.html" class="external-link">print.data.frame</a></span><span class="op">(</span><span class="va">x</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Example output</strong>:</p>
<pre><code>Area of Effect Summary
──────────────────────

 support_id n_total n_core n_halo prop_core prop_halo  area_original     area_aoe area_ratio
          A     312    245     67      0.79      0.21   1.234e+10     4.936e+10       4.00
          B     298    201     97      0.67      0.33   8.921e+09     3.568e+10       4.00
          C     237    166     71      0.70      0.30   5.443e+09     2.177e+10       4.00</code></pre>
<hr></div>
</div>
<div class="section level2">
<h2 id="phase-4-geometry-access">Phase 4: Geometry Access<a class="anchor" aria-label="anchor" href="#phase-4-geometry-access"></a></h2>
<div class="section level3">
<h3 id="id_41-aoe_geometry-function">4.1 <code>aoe_geometry()</code> function<a class="anchor" aria-label="anchor" href="#id_41-aoe_geometry-function"></a></h3>
<p><strong>File</strong>: <code>R/aoe_geometry.R</code></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Extract AoE Geometries</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x An `aoe_result` object</span></span>
<span><span class="co">#' @param which Which geometry to extract: "original", "aoe", or "both"</span></span>
<span><span class="co">#' @param support_id Optional: filter to specific support(s)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return An sf object with polygon geometries</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">aoe_geometry</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">which</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aoe"</span>, <span class="st">"original"</span>, <span class="st">"both"</span><span class="op">)</span>,</span>
<span>                         <span class="va">support_id</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">which</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">which</span><span class="op">)</span></span>
<span>  <span class="va">geoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"aoe_geometries"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">geoms</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"No geometries stored. Rerun aoe() with store_geometry = TRUE"</span>,</span>
<span>         call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Filter by support_id if specified</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">support_id</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">geoms</span> <span class="op">&lt;-</span> <span class="va">geoms</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">geoms</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">support_id</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Extract requested geometries</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">which</span>,</span>
<span>    <span class="st">"original"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">geoms</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sid</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span></span>
<span>        support_id <span class="op">=</span> <span class="va">sid</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"original"</span>,</span>
<span>        geometry <span class="op">=</span> <span class="va">geoms</span><span class="op">[[</span><span class="va">sid</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">original</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"aoe"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">geoms</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sid</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span></span>
<span>        support_id <span class="op">=</span> <span class="va">sid</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"aoe"</span>,</span>
<span>        geometry <span class="op">=</span> <span class="va">geoms</span><span class="op">[[</span><span class="va">sid</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">aoe_final</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"both"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">geoms</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sid</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>        <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>support_id <span class="op">=</span> <span class="va">sid</span>, type <span class="op">=</span> <span class="st">"original"</span>,</span>
<span>                  geometry <span class="op">=</span> <span class="va">geoms</span><span class="op">[[</span><span class="va">sid</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">original</span><span class="op">)</span>,</span>
<span>        <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>support_id <span class="op">=</span> <span class="va">sid</span>, type <span class="op">=</span> <span class="st">"aoe"</span>,</span>
<span>                  geometry <span class="op">=</span> <span class="va">geoms</span><span class="op">[[</span><span class="va">sid</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">aoe_final</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">result</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Usage</strong>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/aoe.html">aoe</a></span><span class="op">(</span><span class="va">pts</span>, <span class="va">supports</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get AoE polygons</span></span>
<span><span class="va">aoe_polys</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/aoe_geometry.html">aoe_geometry</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"aoe"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get both for comparison</span></span>
<span><span class="va">both</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/aoe_geometry.html">aoe_geometry</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"both"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter to one support</span></span>
<span><span class="va">region_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/aoe_geometry.html">aoe_geometry</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"aoe"</span>, support_id <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="phase-5-plot-method">Phase 5: Plot Method<a class="anchor" aria-label="anchor" href="#phase-5-plot-method"></a></h2>
<div class="section level3">
<h3 id="id_51-plotaoe_result">5.1 <code>plot.aoe_result()</code>
<a class="anchor" aria-label="anchor" href="#id_51-plotaoe_result"></a></h3>
<p><strong>File</strong>: <code>R/aoe_class.R</code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @export</span></span>
<span><span class="va">plot.aoe_result</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,</span>
<span>                            <span class="va">support_id</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                            <span class="va">show_aoe</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            <span class="va">show_original</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            <span class="va">col_core</span> <span class="op">=</span> <span class="st">"#2E7D32"</span>,</span>
<span>                            <span class="va">col_halo</span> <span class="op">=</span> <span class="st">"#F57C00"</span>,</span>
<span>                            <span class="va">col_original</span> <span class="op">=</span> <span class="st">"#000000"</span>,</span>
<span>                            <span class="va">col_aoe</span> <span class="op">=</span> <span class="st">"#9E9E9E"</span>,</span>
<span>                            <span class="va">pch</span> <span class="op">=</span> <span class="fl">16</span>,</span>
<span>                            <span class="va">cex</span> <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                            <span class="va">main</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                            <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Filter to support if specified</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">support_id</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">support_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">support_id</span>, <span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">geoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"aoe_geometries"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Determine plot extent</span></span>
<span>  <span class="va">pts_bbox</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">geoms</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">show_aoe</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">aoe_geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/aoe_geometry.html">aoe_geometry</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"aoe"</span>, <span class="va">support_id</span><span class="op">)</span></span>
<span>    <span class="va">aoe_bbox</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">aoe_geom</span><span class="op">)</span></span>
<span>    <span class="va">pts_bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">pts_bbox</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span>, <span class="va">aoe_bbox</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">pts_bbox</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span>, <span class="va">aoe_bbox</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pts_bbox</span><span class="op">[</span><span class="st">"xmax"</span><span class="op">]</span>, <span class="va">aoe_bbox</span><span class="op">[</span><span class="st">"xmax"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pts_bbox</span><span class="op">[</span><span class="st">"ymax"</span><span class="op">]</span>, <span class="va">aoe_bbox</span><span class="op">[</span><span class="st">"ymax"</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Set up plot</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">main</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n_sup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">support_id</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">main</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"AoE: %d points, %d support%s"</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">n_sup</span>, <span class="kw">if</span><span class="op">(</span><span class="va">n_sup</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="st">"s"</span> <span class="kw">else</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span>, type <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>       xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pts_bbox</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span>, <span class="va">pts_bbox</span><span class="op">[</span><span class="st">"xmax"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pts_bbox</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span>, <span class="va">pts_bbox</span><span class="op">[</span><span class="st">"ymax"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>       asp <span class="op">=</span> <span class="fl">1</span>, main <span class="op">=</span> <span class="va">main</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Draw geometries if available</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">geoms</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">show_aoe</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">aoe_geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/aoe_geometry.html">aoe_geometry</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"aoe"</span>, <span class="va">support_id</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">aoe_geom</span><span class="op">)</span>,</span>
<span>           border <span class="op">=</span> <span class="va">col_aoe</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">show_original</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">orig_geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/aoe_geometry.html">aoe_geometry</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"original"</span>, <span class="va">support_id</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">orig_geom</span><span class="op">)</span>,</span>
<span>           border <span class="op">=</span> <span class="va">col_original</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Draw points</span></span>
<span>  <span class="va">core_pts</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">aoe_class</span> <span class="op">==</span> <span class="st">"core"</span>, <span class="op">]</span></span>
<span>  <span class="va">halo_pts</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">aoe_class</span> <span class="op">==</span> <span class="st">"halo"</span>, <span class="op">]</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">halo_pts</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">halo_pts</span><span class="op">)</span>,</span>
<span>         col <span class="op">=</span> <span class="va">col_halo</span>, pch <span class="op">=</span> <span class="va">pch</span>, cex <span class="op">=</span> <span class="va">cex</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">core_pts</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">core_pts</span><span class="op">)</span>,</span>
<span>         col <span class="op">=</span> <span class="va">col_core</span>, pch <span class="op">=</span> <span class="va">pch</span>, cex <span class="op">=</span> <span class="va">cex</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Legend</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>         legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Core"</span>, <span class="st">"Halo"</span>, <span class="st">"Original"</span>, <span class="st">"AoE"</span><span class="op">)</span>,</span>
<span>         col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">col_core</span>, <span class="va">col_halo</span>, <span class="va">col_original</span>, <span class="va">col_aoe</span><span class="op">)</span>,</span>
<span>         pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pch</span>, <span class="va">pch</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>         lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>         lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>         bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>         cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Usage</strong>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/aoe.html">aoe</a></span><span class="op">(</span><span class="va">pts</span>, <span class="va">supports</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Basic plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Single support</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, support_id <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Custom colors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, col_core <span class="op">=</span> <span class="st">"blue"</span>, col_halo <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Without AoE boundary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, show_aoe <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="phase-6-area-diagnostics">Phase 6: Area Diagnostics<a class="anchor" aria-label="anchor" href="#phase-6-area-diagnostics"></a></h2>
<div class="section level3">
<h3 id="id_61-aoe_area-function">6.1 <code>aoe_area()</code> function<a class="anchor" aria-label="anchor" href="#id_61-aoe_area-function"></a></h3>
<p><strong>File</strong>: <code>R/aoe_area.R</code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Compute Area Statistics for AoE</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x An `aoe_result` object, or support sf for standalone use</span></span>
<span><span class="co">#' @param mask Optional mask (if x is support sf)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return Data frame with area statistics per support</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">aoe_area</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">mask</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"aoe_result"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Extract from stored geometries</span></span>
<span>    <span class="va">geoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"aoe_geometries"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">geoms</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"No geometries stored"</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">geoms</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sid</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">geoms</span><span class="op">[[</span><span class="va">sid</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        support_id <span class="op">=</span> <span class="va">sid</span>,</span>
<span>        area_original <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">original</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        area_aoe_raw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">aoe_raw</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        area_aoe_final <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">aoe_final</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"sf"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Compute directly from support</span></span>
<span>    <span class="co"># ... standalone computation</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Derived metrics</span></span>
<span>  <span class="va">result</span><span class="op">$</span><span class="va">expansion_ratio</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">area_aoe_raw</span> <span class="op">/</span> <span class="va">result</span><span class="op">$</span><span class="va">area_original</span></span>
<span>  <span class="va">result</span><span class="op">$</span><span class="va">area_masked</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">area_aoe_raw</span> <span class="op">-</span> <span class="va">result</span><span class="op">$</span><span class="va">area_aoe_final</span></span>
<span>  <span class="va">result</span><span class="op">$</span><span class="va">pct_masked</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">result</span><span class="op">$</span><span class="va">area_masked</span> <span class="op">/</span> <span class="va">result</span><span class="op">$</span><span class="va">area_aoe_raw</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aoe_area_result"</span>, <span class="st">"data.frame"</span><span class="op">)</span></span>
<span>  <span class="va">result</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">print.aoe_area_result</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"AoE Area Statistics\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"───────────────────\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Format areas nicely (km² if large)</span></span>
<span>  <span class="va">x_print</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span>  <span class="va">area_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"area_original"</span>, <span class="st">"area_aoe_raw"</span>, <span class="st">"area_aoe_final"</span>, <span class="st">"area_masked"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">col</span> <span class="kw">in</span> <span class="va">area_cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x_print</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Convert to km² if &gt; 1e6 m²</span></span>
<span>      <span class="va">vals</span> <span class="op">&lt;-</span> <span class="va">x_print</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1e6</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">x_print</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f km²"</span>, <span class="va">vals</span> <span class="op">/</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">x_print</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.0f m²"</span>, <span class="va">vals</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">x_print</span><span class="op">$</span><span class="va">expansion_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2fx"</span>, <span class="va">x</span><span class="op">$</span><span class="va">expansion_ratio</span><span class="op">)</span></span>
<span>  <span class="va">x_print</span><span class="op">$</span><span class="va">pct_masked</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f%%"</span>, <span class="va">x</span><span class="op">$</span><span class="va">pct_masked</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.dataframe.html" class="external-link">print.data.frame</a></span><span class="op">(</span><span class="va">x_print</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Example output</strong>:</p>
<pre><code>AoE Area Statistics
───────────────────

 support_id area_original  area_aoe_raw area_aoe_final  area_masked expansion_ratio pct_masked
          A    12340.5 km²    49362.0 km²    41205.3 km²    8156.7 km²           4.00x     16.5%
          B     8921.2 km²    35684.8 km²    35684.8 km²       0.0 km²           4.00x      0.0%</code></pre>
<hr></div>
</div>
<div class="section level2">
<h2 id="implementation-order">Implementation Order<a class="anchor" aria-label="anchor" href="#implementation-order"></a></h2>
<table class="table"><thead><tr><th>Phase</th>
<th>Component</th>
<th>Effort</th>
<th>Dependencies</th>
</tr></thead><tbody><tr><td>1</td>
<td>S3 class infrastructure</td>
<td>Medium</td>
<td>None</td>
</tr><tr><td>2</td>
<td><code><a href="reference/print.aoe_result.html">print.aoe_result()</a></code></td>
<td>Low</td>
<td>Phase 1</td>
</tr><tr><td>3</td>
<td><code><a href="reference/summary.aoe_result.html">summary.aoe_result()</a></code></td>
<td>Low</td>
<td>Phase 1</td>
</tr><tr><td>4</td>
<td><code><a href="reference/aoe_geometry.html">aoe_geometry()</a></code></td>
<td>Medium</td>
<td>Phase 1</td>
</tr><tr><td>5</td>
<td><code><a href="reference/plot.aoe_result.html">plot.aoe_result()</a></code></td>
<td>Medium</td>
<td>Phase 1, 4</td>
</tr><tr><td>6</td>
<td><code><a href="reference/aoe_area.html">aoe_area()</a></code></td>
<td>Low</td>
<td>Phase 1</td>
</tr></tbody></table><p><strong>Recommended order</strong>: 1 → 2 → 3 → 4 → 6 → 5</p>
<p>Phase 1 is foundational. Phases 2-3-4-6 can be done in any order after Phase 1. Phase 5 depends on Phase 4 for geometry access.</p>
<hr></div>
<div class="section level2">
<h2 id="file-structure-after-implementation">File Structure After Implementation<a class="anchor" aria-label="anchor" href="#file-structure-after-implementation"></a></h2>
<pre><code>R/
├── aoe.R              # Main function (modified)
├── aoe_class.R        # S3 class, print, summary, plot methods
├── aoe_geometry.R     # aoe_geometry() extractor
├── aoe_area.R         # aoe_area() diagnostics
└── aoe_summary.R      # Standalone summary (kept for backwards compat)</code></pre>
<hr></div>
<div class="section level2">
<h2 id="backwards-compatibility">Backwards Compatibility<a class="anchor" aria-label="anchor" href="#backwards-compatibility"></a></h2>
<ul><li>
<code><a href="reference/aoe.html">aoe()</a></code> still returns an sf-compatible object</li>
<li>All existing code using <code>result$aoe_class</code>, <code>result$support_id</code> continues to work</li>
<li>
<code><a href="reference/aoe_summary.html">aoe_summary()</a></code> remains available as standalone function</li>
<li>New functionality is additive</li>
</ul><hr></div>
<div class="section level2">
<h2 id="testing-requirements">Testing Requirements<a class="anchor" aria-label="anchor" href="#testing-requirements"></a></h2>
<p>Each phase requires tests for: 1. Basic functionality 2. Edge cases (empty results, single support, many supports) 3. S3 method dispatch 4. Attribute preservation through subsetting</p>
<hr></div>
<div class="section level2">
<h2 id="documentation-updates">Documentation Updates<a class="anchor" aria-label="anchor" href="#documentation-updates"></a></h2>
<ul><li>Update <code>aoe.Rd</code> with new return structure</li>
<li>Add <code>aoe_geometry.Rd</code>
</li>
<li>Add <code>aoe_area.Rd</code>
</li>
<li>Update vignettes with plot examples</li>
<li>Add “Working with Results” vignette</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gilles Colling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  
</body></html>

