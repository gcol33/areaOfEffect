% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/aoe.R
\name{aoe}
\alias{aoe}
\title{Classify and Prune Points by Area of Effect}
\usage{
aoe(points, support, reference = NULL, mask = NULL)
}
\arguments{
\item{points}{An \code{sf} object with POINT geometries.}

\item{support}{An \code{sf} object with POLYGON or MULTIPOLYGON geometries.
Each row defines a separate support region. When multiple rows are
provided, points are classified against each support independently,
returning long format output where a point may appear multiple times.}

\item{reference}{Optional \code{sf} object with a single POINT geometry.
If \code{NULL} (default), the centroid of each support is used.
Only valid when \code{support} has a single row.}

\item{mask}{Optional \code{sf} object with POLYGON or MULTIPOLYGON geometry.
If provided, each area of effect is intersected with this mask
(e.g., land boundary to exclude sea).}
}
\value{
An \code{sf} object containing only the supported points, with columns:
\describe{
\item{support_id}{Identifier for which support the classification refers to}
\item{aoe_class}{Classification: \code{"core"} or \code{"halo"}}
}
When multiple supports are provided, points may appear multiple times
(once per support whose AoE contains them).

Attribute \code{"scale"} (always 1) is attached to the result.
}
\description{
Given a set of points and one or more support polygons, \code{aoe()} classifies
points as "core" (inside original support) or "halo" (inside the area of
effect but outside original support), pruning all points outside.
}
\details{
The area of effect is computed by scaling each support outward from its
centroid. Scale is fixed at 1 (one full stamp), meaning each point on the
support boundary is moved to twice its distance from the centroid.

The transformation applies:
\deqn{p' = r + 2(p - r)}
where \eqn{r} is the reference point (centroid) and \eqn{p} is each vertex
of the support boundary.

Points exactly on the original support boundary are classified as "core".

The support geometry is validated internally using \code{\link[sf:valid]{sf::st_make_valid()}}.
}
\examples{
library(sf)

# Single support
support <- st_as_sf(
  data.frame(id = 1),
  geometry = st_sfc(st_polygon(list(
    cbind(c(0, 10, 10, 0, 0), c(0, 0, 10, 10, 0))
  ))),
  crs = 32631
)

pts <- st_as_sf(
  data.frame(id = 1:4),
  geometry = st_sfc(
    st_point(c(5, 5)),
    st_point(c(2, 2)),
    st_point(c(15, 5)),
    st_point(c(30, 30))
  ),
  crs = 32631
)

result <- aoe(pts, support)

# Multiple supports (e.g., admin regions)
supports <- st_as_sf(
  data.frame(region = c("A", "B")),
  geometry = st_sfc(
    st_polygon(list(cbind(c(0, 10, 10, 0, 0), c(0, 0, 10, 10, 0)))),
    st_polygon(list(cbind(c(8, 18, 18, 8, 8), c(0, 0, 10, 10, 0))))
  ),
  crs = 32631
)

result <- aoe(pts, supports)
# Points near the boundary may appear in both regions' AoE

}
